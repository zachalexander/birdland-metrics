@if (!focusedPlayerId()) {
<div class="benchmarks-header">
  <div class="benchmarks-meta">
    @if (formattedUpdated(); as date) {
      <span class="benchmarks-updated">Updated {{ date }}</span>
    }
    <span class="benchmarks-source">Data via FanGraphs</span>
  </div>
  <div class="progress-display">
    <span class="progress-met">{{ totalMet() }}</span>
    <span class="progress-separator">/</span>
    <span class="progress-total">{{ totalBenchmarks() }}</span>
    <span class="progress-label">benchmarks met</span>
  </div>
  <div class="progress-bar-track">
    <div class="progress-bar-fill" [style.width.%]="progressPct()"></div>
  </div>
</div>

<select class="mobile-filter" [value]="mobileFilter()" (change)="onMobileFilterChange($any($event.target).value)">
  <option value="all">All Players</option>
  <option value="batters">All Position Players</option>
  <option value="pitchers">All Pitchers</option>
  <optgroup label="Position Players">
    @for (player of batters(); track player.playerId) {
      <option [value]="player.playerId">{{ player.name }}</option>
    }
  </optgroup>
  <optgroup label="Pitchers">
    @for (player of pitchers(); track player.playerId) {
      <option [value]="player.playerId">{{ player.name }}</option>
    }
  </optgroup>
</select>
}

@if (filteredBatters().length) {
<div class="group">
  @if (!focusedPlayerId()) {
    <p class="group-label">Position Players</p>
  }
  <div class="players-grid" [class.focused-grid]="!!focusedPlayerId()">
    @for (player of filteredBatters(); track player.playerId) {
      <div class="player-card"
           [class.focused]="!!focusedPlayerId()"
           [class.all-met]="playerMetCount(player) === player.benchmarks.length"
           [class.some-met]="playerMetCount(player) > 0 && playerMetCount(player) < player.benchmarks.length">
        <div class="card-header">
          <div class="avatar-wrapper">
            @if (avatarUrl(player.playerId); as avatar) {
              <img class="player-avatar" [src]="avatar" [alt]="player.name">
            } @else {
              <span class="jersey-number">{{ jerseyNumber(player.playerId) }}</span>
            }
            @if (isInjured(player.playerId)) {
              <span class="injury-badge" title="Injured List">IL</span>
            }
          </div>
          <div class="player-info">
            <span class="player-name">{{ player.name }}</span>
            <span class="player-position">{{ player.position }}</span>
            @if (injuryInfo(player.playerId); as injury) {
              <span class="injury-detail">{{ injury.diagnosis }} · {{ injury.returnDate }}</span>
            }
          </div>
          <div class="card-header-right">
            <div class="stat-col-headers">
              <span class="stat-col-header">'25</span>
              <span class="stat-col-header">Now</span>
              <span class="stat-col-header">Proj</span>
            </div>
          </div>
        </div>
        <div class="benchmark-rows">
          @for (bm of player.benchmarks; track bm.key) {
            <div class="benchmark-row" [class.met]="isMet(player.playerId, bm)" [class.unmet]="!isMet(player.playerId, bm)">
              <span class="benchmark-icon">
                @if (isMet(player.playerId, bm)) {
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="currentColor" fill-opacity="0.1"/>
                    <path d="M5 8.5L7 10.5L11 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                } @else {
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                }
              </span>
              <div class="benchmark-body">
                <span class="benchmark-label">
                  {{ bm.label }}
                  @if (tooltip(bm.key); as tip) {
                    <span class="info-trigger" [attr.aria-label]="tip">
                      <svg class="info-icon" width="11" height="11" viewBox="0 0 16 16" fill="none">
                        <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 7.5V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <circle cx="8" cy="5.5" r="0.75" fill="currentColor"/>
                      </svg>
                      <span class="info-tooltip">{{ tip }}</span>
                    </span>
                  }
                </span>
                <span class="benchmark-desc">{{ bm.description }}</span>
              </div>
              <div class="benchmark-stats">
                <span class="stat-col" [class.stat-met]="bm.current === null && was2025Met(player.playerId, bm)">
                  {{ format2025Value(player.playerId, bm) ?? '—' }}
                </span>
                <span class="stat-col" [class.stat-met]="isMet(player.playerId, bm)"
                      [class.stat-unmet]="!isMet(player.playerId, bm)">
                  {{ formatValue(player.playerId, bm) }}
                </span>
                <span class="stat-col" [class.stat-met]="bm.current !== null && isRosProjectionMet(bm)"
                      [class.stat-unmet]="bm.current !== null && isRosProjectionMet(bm) === false">
                  {{ formatRosProjected(bm) ?? '—' }}
                </span>
              </div>
            </div>
          }
        </div>
        @if (!focusedPlayerId()) {
          <div class="card-footer">
            <div class="card-footer-share">
              <app-share-buttons [title]="player.name + ' — Core Benchmarks'" [path]="playerSharePath(player.playerId)" />
            </div>
            <a class="card-detail-link" [routerLink]="playerSharePath(player.playerId)">Why these benchmarks? &rarr;</a>
          </div>
        }
      </div>
    }
  </div>
</div>
}

@if (filteredPitchers().length) {
<div class="group">
  @if (!focusedPlayerId()) {
    <p class="group-label">Pitchers</p>
  }
  <div class="players-grid" [class.focused-grid]="!!focusedPlayerId()">
    @for (player of filteredPitchers(); track player.playerId) {
      <div class="player-card"
           [class.focused]="!!focusedPlayerId()"
           [class.all-met]="playerMetCount(player) === player.benchmarks.length"
           [class.some-met]="playerMetCount(player) > 0 && playerMetCount(player) < player.benchmarks.length">
        <div class="card-header">
          <div class="avatar-wrapper">
            @if (avatarUrl(player.playerId); as avatar) {
              <img class="player-avatar" [src]="avatar" [alt]="player.name">
            } @else {
              <span class="jersey-number">{{ jerseyNumber(player.playerId) }}</span>
            }
            @if (isInjured(player.playerId)) {
              <span class="injury-badge" title="Injured List">IL</span>
            }
          </div>
          <div class="player-info">
            <span class="player-name">{{ player.name }}</span>
            <span class="player-position">{{ player.position }}</span>
            @if (injuryInfo(player.playerId); as injury) {
              <span class="injury-detail">{{ injury.diagnosis }} · {{ injury.returnDate }}</span>
            }
          </div>
          <div class="card-header-right">
            <div class="stat-col-headers">
              <span class="stat-col-header">'25</span>
              <span class="stat-col-header">Now</span>
              <span class="stat-col-header">Proj</span>
            </div>
          </div>
        </div>
        <div class="benchmark-rows">
          @for (bm of player.benchmarks; track bm.key) {
            <div class="benchmark-row" [class.met]="isMet(player.playerId, bm)" [class.unmet]="!isMet(player.playerId, bm)">
              <span class="benchmark-icon">
                @if (isMet(player.playerId, bm)) {
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="currentColor" fill-opacity="0.1"/>
                    <path d="M5 8.5L7 10.5L11 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                } @else {
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                }
              </span>
              <div class="benchmark-body">
                <span class="benchmark-label">
                  {{ bm.label }}
                  @if (tooltip(bm.key); as tip) {
                    <span class="info-trigger" [attr.aria-label]="tip">
                      <svg class="info-icon" width="11" height="11" viewBox="0 0 16 16" fill="none">
                        <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 7.5V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <circle cx="8" cy="5.5" r="0.75" fill="currentColor"/>
                      </svg>
                      <span class="info-tooltip">{{ tip }}</span>
                    </span>
                  }
                </span>
                <span class="benchmark-desc">{{ bm.description }}</span>
              </div>
              <div class="benchmark-stats">
                <span class="stat-col" [class.stat-met]="bm.current === null && was2025Met(player.playerId, bm)">
                  {{ format2025Value(player.playerId, bm) ?? '—' }}
                </span>
                <span class="stat-col" [class.stat-met]="isMet(player.playerId, bm)"
                      [class.stat-unmet]="!isMet(player.playerId, bm)">
                  {{ formatValue(player.playerId, bm) }}
                </span>
                <span class="stat-col" [class.stat-met]="bm.current !== null && isRosProjectionMet(bm)"
                      [class.stat-unmet]="bm.current !== null && isRosProjectionMet(bm) === false">
                  {{ formatRosProjected(bm) ?? '—' }}
                </span>
              </div>
            </div>
          }
        </div>
        @if (!focusedPlayerId()) {
          <div class="card-footer">
            <div class="card-footer-share">
              <app-share-buttons [title]="player.name + ' — Core Benchmarks'" [path]="playerSharePath(player.playerId)" />
            </div>
            <a class="card-detail-link" [routerLink]="playerSharePath(player.playerId)">Why these benchmarks? &rarr;</a>
          </div>
        }
      </div>
    }
  </div>
</div>
}
